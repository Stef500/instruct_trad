services:
  medical-dataset-processor:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: medical-dataset-processor-web
    ports:
      - "5000:5000"
    environment:
      # API Keys - Set these in your .env file or environment
      - DEEPL_API_KEY=${DEEPL_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      
      # Flask configuration
      - FLASK_APP=medical_dataset_processor.web.app:create_app
      - FLASK_ENV=production
      - SECRET_KEY=${SECRET_KEY:-dev-secret-key-change-in-production}
      
      # Translation configuration
      - TARGET_LANGUAGE=${TARGET_LANGUAGE:-FR}
      - TRANSLATION_MAX_RETRIES=${TRANSLATION_MAX_RETRIES:-3}
      - TRANSLATION_BASE_DELAY=${TRANSLATION_BASE_DELAY:-1.0}
      - TRANSLATION_MAX_DELAY=${TRANSLATION_MAX_DELAY:-60.0}
      
      # Web server configuration
      - WEB_HOST=0.0.0.0
      - WEB_PORT=5000
      
      # Session configuration
      - SESSION_TIMEOUT=${SESSION_TIMEOUT:-86400}
      - AUTO_SAVE_INTERVAL=${AUTO_SAVE_INTERVAL:-5}
    volumes:
      # Persist session data and output
      - ./data:/app/data
      - ./output:/app/output
      - ./logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  default:
    name: medical-dataset-processor-network